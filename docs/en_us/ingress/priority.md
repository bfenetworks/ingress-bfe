# Priority of route rules
If a request matches multiple ingress rules, BFE Ingress Controller will decide which rule will be hit according to below strategies:

-  Compares the hostname and select the rule with more precise hostname；
-  If hostname is identical, select the rule with more precise path；
-  If both hostname and path are identical, select the rule with more matching advanced conditions;
-  If all the above criteria are the same, select the rule which matches an advanced condition of higher priority
   - in advanced match condition, Cookie condition has higher priority than Header condition；

## Examples
### Hostname precision first
```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "host_priority1"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service1
              servicePort: 80
---
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "host_priority2"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
spec:
  rules:
    - host: *.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service2
              servicePort: 80
```
In above example, for requests generated by `curl "http://example.net/bar"`, rule in `host_priority1` will be hit

### Path precision first when hostname are identical
```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "path_priority1"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar/foo
            backend:
              serviceName: service1
              servicePort: 80
---
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "path_priority2"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
    bfe.ingress.kubernetes.io/router.header: "key: value"
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service2
              servicePort: 80
```
In above example, for requests generated by `curl "http://example.net/bar/foo" -H "Key: value"`, rule in `path_priority1` will be hit

### More matched advanced condition first, when hostname and path both identical
```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "cond_priority1"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
    bfe.ingress.kubernetes.io/router.header: "key: value"
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service1
              servicePort: 80
---
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "cond_priority1"
  namespace: production  
  annotations:
    kubernetes.io/ingress.class: bfe 
  
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service2
              servicePort: 80
```
In above example, for requests generated by `curl "http://example.net/bar/foo" -H "Key: value"`, rule in `cond_priority1` will be hit

### Matched advanced condition with higher priority first, when above criteria are the same
```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "multi_cond_priority1"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
    bfe.ingress.kubernetes.io/router.header: "header-key: value"
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service1
              servicePort: 80
---
kind: Ingress
apiVersion: networking.k8s.io/v1beta1
metadata:
  name: "multi_cond_priority2"
  namespace: production
  annotations:
    kubernetes.io/ingress.class: bfe 
    bfe.ingress.kubernetes.io/router.cookie: "cookie-key: value"
spec:
  rules:
    - host: example.net
      http:
        paths:
          - path: /bar
            backend:
              serviceName: service2
              servicePort: 80
```
In above example, for requests generated by `curl "http://example.net/bar/foo" -H "Header-key: value" --cookie "cookie-key: value"`, rule in `multi_cond_priority2` will be hit, as `Cookie` condition has higher priority than `Header` condition

